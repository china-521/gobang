window.addEventListener("load",function(){var q=document.querySelector(".chess");var b=document.querySelector(".retractBtn");var a=document.querySelector(".unretractBtn");var E=document.querySelector(".restartBtn");var H=document.querySelector(".menuBtn");var P=document.querySelector(".wrapper");var k=document.querySelector(".menuWrap");var A=document.querySelector(".playerStep > span");var L=document.querySelector(".playerScore > span");var T=document.querySelector(".playerWin > span");var s=document.querySelector(".computerStep > span");var t=document.querySelector(".computerScore > span");var I=document.querySelector(".computerWin > span");var l=new Audio("video/chessDown.mp3");var K=new Audio("video/win.mp3");var X=new Audio("video/fail.mp3");var c=15;var p,g;var e=-1,d=-1;var D=false;var Z=false;var m=false;var M=false;var Y=true;var C=[];for(var R=0;R<c;R++){C[R]=[]}var n=[];for(var R=0;R<c;R++){n[R]=[]}for(var R=0;R<c;R++){for(var o=0;o<c;o++){n[R][o]=0;console.log(n[R][o])}}if(q.getContext){var J=q.getContext("2d")}function f(){for(var j=0;j<c;j++){J.save();J.beginPath();J.moveTo(20,20+j*40);J.lineTo(580,20+j*40);J.stroke();J.save();J.beginPath();J.moveTo(20+j*40,20);J.lineTo(20+j*40,580);J.stroke();J.restore()}}function N(i,j,v){J.fillStyle=v?"#000":"#fff";J.beginPath();J.arc(20+i*40,20+j*40,10,0,360*Math.PI/180,true);J.fill()}function G(){J.clearRect(0,0,q.width,q.height);f();for(var v=0;v<c;v++){for(var w=0;w<c;w++){n[v][w]=0}}}function B(i,j){J.clearRect(i*40,j*40,40,40);n[i][j]=0;i=i*40+20;j=j*40+20;J.beginPath();J.moveTo(i-20,j);J.lineTo(i+20,j);J.stroke();J.beginPath();J.moveTo(i,j-20);J.lineTo(i,j+20);J.stroke()}function W(w,v,Aa){var Ae=0;var Ac=w;var Ad=v;for(var Ab=Ac-1;Ab>=0;Ab--){if(n[Ab][Ad]==Aa){Ae++}else{break}}for(var Ab=Ac+1;Ab<c;Ab++){if(n[Ab][Ad]==Aa){Ae++}else{break}}if(Ae>=4){return true}Ae=0;for(var Ab=Ad-1;Ab>=0;Ab--){if(n[Ac][Ab]==Aa){Ae++}else{break}}for(var Ab=Ad+1;Ab<c;Ab++){if(n[Ac][Ab]==Aa){Ae++}else{break}}if(Ae>=4){return true}Ae=0;for(var Ab=Ac-1,z=Ad-1;Ab>=0&&z>=0;Ab--,z--){if(n[Ab][z]==Aa){Ae++}else{break}}for(var Ab=Ac+1,z=Ad+1;Ab<c&&z<c;Ab++,z++){if(n[Ab][z]==Aa){Ae++}else{break}}if(Ae>=4){return true}Ae=0;for(var Ab=Ac-1,z=Ad+1;Ab>=0&&z<c;Ab--,z++){if(n[Ab][z]==Aa){Ae++}else{break}}for(var Ab=Ac+1,z=Ad-1;Ab<c&&z>=0;Ab++,z--){if(n[Ab][z]==Aa){Ae++}else{break}}if(Ae>=4){return true}Ae=0}function U(){var w=0;for(var v=0;v<c;v++){for(var x=0;x<c;x++){if(n[v][x]!=0){w++}else{break}}}if(w==225){return true}}b.addEventListener("click",function(){clickSound.play();if(D){alert("游戏已经结束，无法悔棋！")}else{if(Z==false){alert("无法悔棋！")}else{Z=false;m=true;B(p,g);B(e,d);u("","retract");O("","retract")}}});a.addEventListener("click",function(){clickSound.play();if(D){alert("游戏已经结束，无法撤销悔棋！")}else{if(m==false){alert("无法撤销！")}else{m=false;Z=true;N(p,g,true);N(e,d,false);n[p][g]=1;n[e][d]=2;u();O()}}});E.addEventListener("click",function(){clickSound.play();if(M){M=false;var i=confirm("重新开始将会清空当前游戏进度，确定要重新开始吗？");if(i){G();D=false;Y=true;Z=false;m=false;u("","clearAll");O("","clearAll")}}else{confirm("尚未开始对局！")}});H.addEventListener("click",function(){clickSound.play();D=false;Y=true;Z=false;m=false;var i=confirm("返回主菜单将清空所有游戏数据，是否继续？");if(i){window.free.toggleClass(k,"displays");window.free.toggleClass(P,"displays");u("","clearAll");O("","clearAll");G();gameSound.pause();if(music){menuSound.play()}else{menuSound.pause()}}});var V=0;var r=0;function u(i,j){if(j=="clearAll"){V=-1;r=0;T.innerHTML=r+"次"}if(j=="clearPath"){V=-1}if(j=="retract"){V-=2}V++;A.innerHTML=(V)+"步";L.innerHTML=(V*10)+"分";if(i){r++;T.innerHTML=r+"次"}}var S=0;var F=0;function O(i,j){if(j=="clearAll"){S=-1;F=0;I.innerHTML=F+"次"}if(j=="clearPath"){S=-1}if(j=="retract"){S-=2}S++;s.innerHTML=(S)+"步";t.innerHTML=(S*10)+"分";if(i){F++;I.innerHTML=F+"次"}}q.addEventListener("click",function(j){j=j||window.event;if(Y==false){alert("不要急，还没有轮到你哦。");return}if(D==true){alert("游戏已经结束，请点击重新开始。");return}p=Math.floor(j.offsetX/40);g=Math.floor(j.offsetY/40);console.log(p);if(n[p][g]==0){N(p,g,true);u();l.play();Z=true;m=false;M=true;n[p][g]=1;if(W(p,g,num=1)){D=true;u(true);K.play();Y=true;var i=confirm("你赢了，再来一局？");if(i){G();u("","clearPath");O("","clearPath");D=false}}else{if(U()){D=true;Y=true;var i=confirm("占成平局，再来一局？");if(i){G();u("","clearPath");O("","clearPath");D=false}}else{Y=false}}}else{alert("当前位置已被占据，请选择其他位置落子")}if(D==false&&Y==false){h()}});function Q(j,i){if(j>0&&i>0){return 0}if(j==0&&i==0){return 7}if(i==1){return 35}if(i==2){return 800}if(i==3){return 15000}if(i==4){return 800000}if(j==1){return 15}if(j==2){return 400}if(j==3){return 1800}if(j==4){return 100000}return -1}function h(){for(var Aa=0;Aa<c;Aa++){for(var y=0;y<c;y++){C[Aa][y]=0}}var Ae=0;var w=0;var v=0;var Ad=-1;for(var Aa=0;Aa<c;Aa++){for(var y=0;y<c-4;y++){for(var z=y;z<y+5;z++){if(n[z][Aa]==1){Ae++}else{if(n[z][Aa]==2){w++}}}v=Q(Ae,w);for(var z=y;z<y+5;z++){C[z][Aa]+=v}Ae=0;w=0;v=0}}for(var Aa=0;Aa<c;Aa++){for(var y=0;y<c-4;y++){for(var z=0;z<y+5;z++){if(n[Aa][z]==1){Ae++}else{if(n[Aa][z]==2){w++}}}v=Q(Ae,w);for(var z=y;z<y+5;z++){C[Aa][z]+=v}Ae=0;w=0;v=0}}for(var Aa=c-1;Aa>=4;Aa--){for(var z=Aa,y=0;y<c&&z>=0;y++,z--){var Ac=z;var Ab=y;for(;Ac>z-5&&z-5>=-1;Ac--,Ab++){if(n[Ac][Ab]==1){Ae++}else{if(n[Ac][Ab]==2){w++}}}if(Ac==z-5){v=Q(Ae,w);for(Ac=z,Ab=y;Ac>z-5;Ac--,Ab++){C[Ac][Ab]+=v}}Ae=0;w=0;v=0}}for(var Aa=1;Aa<15;Aa++){for(var z=Aa,y=c-1;y>=0&&z<15;y--,z++){var Ac=z;var Ab=y;for(;Ac<z+5&&z+5<=15;Ac++,Ab--){if(n[Ab][Ac]==1){Ae++}else{if(n[Ab][Ac]==2){w++}}}if(Ac==z+5){v=Q(Ae,w);for(Ac=z,Ab=y;Ac<z+5;Ac++,Ab--){C[Ab][Ac]+=v}}Ae=0;w=0;v=0}}for(var Aa=0;Aa<c-1;Aa++){for(var z=Aa,y=0;y<c&&z<c;y++,z++){var Ac=z;var Ab=y;for(;Ac<z+5&&z+5<=c;Ac++,Ab++){if(n[Ac][Ab]==1){Ae++}else{if(n[Ac][Ab]==2){w++}}}if(Ac==z+5){v=Q(Ae,w);for(Ac=z,Ab=y;Ac<z+5;Ac++,Ab++){C[Ac][Ab]+=v}}Ae=0;w=0;v=0}}for(var Aa=1;Aa<c-4;Aa++){for(var z=Aa,y=0;y<c&&z<c;y++,z++){var Ac=z;var Ab=y;for(;Ac<z+5&&z+5<=c;Ac++,Ab++){if(n[Ab][Ac]==1){Ae++}else{if(n[Ab][Ac]==2){w++}}}if(Ac==z+5){v=Q(Ae,w);for(Ac=z,Ab=y;Ac<z+5;Ac++,Ab++){C[Ab][Ac]+=v}}Ae=0;w=0;v=0}}for(var Aa=0;Aa<c;Aa++){for(var y=0;y<c;y++){if(n[Aa][y]==0&&C[Aa][y]>Ad){e=Aa;d=y;Ad=C[Aa][y]}}}if(e!=-1&&d!=-1&&n[e][d]==0){N(e,d,false);O();n[e][d]=2;if(W(e,d,num=2)){D=true;O(true);Y=true;var x=confirm("你输了，再来一局？");X.play();if(x){G();u("","clearPath");O("","clearPath");D=false}}else{if(U()){D=true;Y=true;var x=confirm("占成平局，再来一局？");if(x){G();u("","clearPath");O("","clearPath");D=false}}else{Y=true}}}}(function(){f()})()});